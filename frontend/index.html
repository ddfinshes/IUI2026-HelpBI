<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IUI2026 HelpBI</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
    .btn:hover { background: #0056b3; }
    .loading { color: #666; font-style: italic; }
    .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 4px; margin: 10px 0; }
    .success { color: #155724; background: #d4edda; padding: 10px; border-radius: 4px; margin: 10px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background: #f8f9fa; font-weight: 600; }
    .positive { color: #28a745; }
    .negative { color: #dc3545; }
  </style>
</head>
<body>
  <div id="app">
    <div class="container">
      <div class="header">
        <h1>IUI2026 HelpBI 数据看板</h1>
        <p>基于 FastAPI + Vue 的智能商业分析平台</p>
      </div>
      
      <div class="card">
        <h2>API 测试</h2>
        <button class="btn" @click="testPing">测试 Ping</button>
        <button class="btn" @click="testHealth">测试 Health</button>
        <div v-if="pingResult" :class="pingResult.success ? 'success' : 'error'">
          {{ pingResult.message }}
        </div>
      </div>
      
      <div class="card">
        <h2>仪表板摘要</h2>
        <button class="btn" @click="loadDashboard">加载摘要数据</button>
        <div v-if="dashboardLoading" class="loading">加载中...</div>
        <div v-if="dashboardError" class="error">{{ dashboardError }}</div>
        <div v-if="dashboardData" class="success">
          <p><strong>总销售额:</strong> ¥{{ dashboardData.total_sales?.toLocaleString() }}</p>
          <p><strong>总订单数:</strong> {{ dashboardData.total_orders?.toLocaleString() }}</p>
          <p><strong>总客户数:</strong> {{ dashboardData.total_customers?.toLocaleString() }}</p>
          <p><strong>增长率:</strong> {{ dashboardData.growth_rate }}%</p>
          <p><strong>主要区域:</strong> {{ dashboardData.top_region }}</p>
        </div>
      </div>
      
      <div class="card">
        <h2>销售报表数据</h2>
        <button class="btn" @click="loadReports">加载报表数据</button>
        <div v-if="reportsLoading" class="loading">加载中...</div>
        <div v-if="reportsError" class="error">{{ reportsError }}</div>
        <div v-if="reportsData && reportsData.length > 0">
          <p class="success">成功加载 {{ reportsData.length }} 条记录</p>
          <table>
            <thead>
              <tr>
                <th>标题</th>
                <th>数值</th>
                <th>变化</th>
                <th>变化率</th>
                <th>类别</th>
                <th>日期</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="item in reportsData" :key="item.id">
                <td>{{ item.title }}</td>
                <td>¥{{ item.value?.toLocaleString() }}</td>
                <td :class="item.change >= 0 ? 'positive' : 'negative'">
                  {{ item.change >= 0 ? '+' : '' }}{{ item.change?.toLocaleString() }}
                </td>
                <td :class="item.change_percent >= 0 ? 'positive' : 'negative'">
                  {{ item.change_percent >= 0 ? '+' : '' }}{{ item.change_percent?.toFixed(2) }}%
                </td>
                <td>{{ item.category }}</td>
                <td>{{ new Date(item.date).toLocaleDateString() }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    const { createApp, ref } = Vue;
    
    createApp({
      setup() {
        const pingResult = ref(null);
        const dashboardData = ref(null);
        const dashboardLoading = ref(false);
        const dashboardError = ref(null);
        const reportsData = ref([]);
        const reportsLoading = ref(false);
        const reportsError = ref(null);
        
        const testPing = async () => {
          try {
            const response = await fetch('/api/v1/ping');
            const data = await response.json();
            pingResult.value = { success: true, message: `Ping 成功: ${data.message}` };
          } catch (error) {
            pingResult.value = { success: false, message: `Ping 失败: ${error.message}` };
          }
        };
        
        const testHealth = async () => {
          try {
            const response = await fetch('/health');
            const data = await response.json();
            pingResult.value = { success: true, message: `Health 检查成功: ${data.status}` };
          } catch (error) {
            pingResult.value = { success: false, message: `Health 检查失败: ${error.message}` };
          }
        };
        
        const loadDashboard = async () => {
          dashboardLoading.value = true;
          dashboardError.value = null;
          try {
            const response = await fetch('/api/v1/reports/dashboard');
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            dashboardData.value = await response.json();
          } catch (error) {
            dashboardError.value = `加载失败: ${error.message}`;
          } finally {
            dashboardLoading.value = false;
          }
        };
        
        const loadReports = async () => {
          reportsLoading.value = true;
          reportsError.value = null;
          try {
            const response = await fetch('/api/v1/reports/sales');
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();
            reportsData.value = data.data || [];
          } catch (error) {
            reportsError.value = `加载失败: ${error.message}`;
          } finally {
            reportsLoading.value = false;
          }
        };
        
        return {
          pingResult,
          dashboardData,
          dashboardLoading,
          dashboardError,
          reportsData,
          reportsLoading,
          reportsError,
          testPing,
          testHealth,
          loadDashboard,
          loadReports
        };
      }
    }).mount('#app');
  </script>
  
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</body>
</html>
